{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/CookieCutterSuburbia.ts","src/HouseBuilder.ts","src/SmartRender.ts","src/main.ts"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","BABYLON","Texture","CookieCutterSuburbia","canvas","engine","Engine","scene","Scene","clearColor","Color4","camera","UniversalCamera","Vector3","rotation","speed","attachControl","HemisphericLight","intensity","PointLight","box","MeshBuilder","CreateBox","width","height","depth","position","y","Math","PI","ground","CreateGround","subdivisions","red","StandardMaterial","diffuseColor","Color3","material","groundTexture","uScale","vScale","wrapU","MIRROR_ADDRESSMODE","wrapV","groundMaterial","diffuseTexture","intervalID","setInterval","isReady","render","clearInterval","yRot","Animation","ANIMATIONTYPE_FLOAT","ANIMATIONLOOPMODE_CYCLE","keyFramesR","push","frame","value","setKeys","beginDirectAnimation","this","HouseBuilder","callback","incrementX","incrementZ","xStart","xEnd","originalHouse","houses","clearHouses","prototype","getOriginalHouse","_this","executeCallbacks","SceneLoader","Append","house","getNodeByID","setEnabled","addHouseClone","clone","addAndPosition","addHouseCreateInstance","createInstance","x","nextX","z","nextZ","window","setTimeout","undefined","forEach","dispose","mergeHouses","mergedHouses","Mesh","MergeMeshes","lodManual","lodRemoveAll","arg","original","_lodRemoveAll","id","boxMaterial","addLODLevel","lodAutomatic","simplify","quality","distance","optimizeMesh","SimplificationType","QUADRATIC","alert","getLODLevels","lodLevel","removeLODLevel","mesh","SmartRenderer","alwaysRender","forceRenderOnce","lastPosition","lastRotation","onWinResize","getEngine","resize","onRender","isRenderNeeded","activeCamera","runRenderLoop","addEventListener","animatables","update","equals","debugLayer","isVisible","CookieCutterSuburbia_1","SmartRender_1","HouseBuilder_1","document","getElementById","default","smartRender","smartRenderToggle","updateSmartRenderToggleStyleClass","classList","toggle","event","houseBuilder","housesNumberToAdd","preventDefault","numberToAdd","parseInt","addAnother","hide","show"],"mappings":"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","file":"main.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","import * as BABYLON from 'babylonjs';\r\nimport Texture = BABYLON.Texture;\r\n\r\nexport default class CookieCutterSuburbia {\r\n\tpublic scene: BABYLON.Scene;\r\n\r\n\tconstructor(canvas: HTMLCanvasElement) {\r\n\t\tconst adaptToDeviceRatio = false;\r\n\t\tconst engine = new BABYLON.Engine(canvas, true, {}, adaptToDeviceRatio);\r\n\r\n\t\tconst scene = new BABYLON.Scene(engine);\r\n\t\tscene.clearColor = new BABYLON.Color4(0.5, 0.8, 0.8, 1);\r\n//\t\tscene.ambientColor = new BABYLON.Color3(1,0,0);\r\n\r\n\t\t// TODO: remove?\r\n\t\t//scene.autoClear = true;\r\n\t\t//scene.shadowsEnabled = false;\r\n\r\n\t\tconst camera = new BABYLON.UniversalCamera(\"camera\", new BABYLON.Vector3(-5, 1.5, 4), scene);\r\n\t\tcamera.rotation = new BABYLON.Vector3(0.14, 8.5, 0);\r\n\t\tcamera.speed = 0.4;\r\n\t\tcamera.attachControl(canvas, true);\r\n\r\n\t\tconst hemiLight = new BABYLON.HemisphericLight('hemiLight', new BABYLON.Vector3(-0.5, -1, -0.5), scene);\r\n\t\themiLight.intensity = 0.2;\r\n\r\n\t\tconst pointLight = new BABYLON.PointLight('pointLight', new BABYLON.Vector3(-3, 5, 3), scene);\r\n\t\tpointLight.intensity = 0.50;\r\n\r\n\t\tconst pointLight_2 = new BABYLON.PointLight('pointLight_2', new BABYLON.Vector3(8, 35, 22), scene);\r\n\t\tpointLight_2.intensity = 0.50;\r\n\r\n\t\t// Create box\r\n\t\tconst box = BABYLON.MeshBuilder.CreateBox(\"box\", {width: 1, height: 1, depth: 1}, scene);\r\n\t\tbox.position.y = 1.5;\r\n\t\tbox.rotation = new BABYLON.Vector3(Math.PI/4, Math.PI/4, Math.PI/4);\r\n\r\n\t\t// Create ground\r\n\t\tconst ground = BABYLON.MeshBuilder.CreateGround(\"ground\", {width: 80, height: 80, subdivisions: 8}, scene);\r\n\r\n\t\t// Material for box\r\n\t\tconst red = new BABYLON.StandardMaterial(\"red\", scene);\r\n\t\tred.diffuseColor = new BABYLON.Color3(1, 0, 0);\r\n\t\tbox.material = red;\r\n\r\n\t\t// Material for ground\r\n\t\tconst groundTexture = new BABYLON.Texture(\"grass.jpg\", scene);\r\n\t\tgroundTexture.uScale = 8;\r\n\t\tgroundTexture.vScale = 8;\r\n\t\tgroundTexture.wrapU = Texture.MIRROR_ADDRESSMODE;\r\n\t\tgroundTexture.wrapV = Texture.MIRROR_ADDRESSMODE;\r\n\t\tconst groundMaterial = new BABYLON.StandardMaterial(\"grass\", scene);\r\n\t\tgroundMaterial.diffuseTexture = groundTexture;\r\n\t\tconst installMaterialWhenTextureReady = () => {\r\n\t\t\tif (groundTexture.isReady()) {\r\n\t\t\t\tground.material = groundMaterial;\r\n\t\t\t\tscene.render();\r\n\t\t\t\tclearInterval(intervalID);\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet intervalID = setInterval(installMaterialWhenTextureReady, 100);\r\n\r\n\t\t// https://doc.babylonjs.com/how_to/combine\r\n\t\tlet frameRate = 200;\r\n\t\tlet yRot = new BABYLON.Animation(\"yRot\", \"rotation.y\", frameRate, BABYLON.Animation.ANIMATIONTYPE_FLOAT, BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE);\r\n\t\tvar keyFramesR = [];\r\n\t\tkeyFramesR.push({\r\n\t\t\tframe: 0,\r\n\t\t\tvalue: 0\r\n\t\t});\r\n\t\tkeyFramesR.push({\r\n\t\t\tframe: 2 * frameRate,\r\n\t\t\tvalue: 2 * Math.PI\r\n\t\t});\r\n\t\tyRot.setKeys(keyFramesR);\r\n\t\tscene.beginDirectAnimation(box, [yRot], 0, 2 * frameRate, true);\r\n\r\n\t\tthis.scene = scene;\r\n\t}\r\n}\r\n","import * as BABYLON from 'babylonjs';\r\n\r\ninterface newHouseCallback {\r\n\t(house: BABYLON.AbstractMesh): void;\r\n}\r\n\r\nexport default class HouseBuilder {\r\n\tprivate readonly scene: BABYLON.Scene;\r\n\tprivate readonly callback: (() => void) | undefined;\r\n\r\n\tprivate readonly incrementX = 1;\r\n\tprivate readonly incrementZ = -1;\r\n\tprivate readonly xStart = 0;\r\n\tprivate readonly xEnd = 20;\r\n\tprivate nextX: number;\r\n\tprivate nextZ: number;\r\n\r\n\tprivate originalHouse: BABYLON.Mesh = null;\r\n\tprivate houses: BABYLON.AbstractMesh[] = [];\r\n\r\n\tconstructor(scene: BABYLON.Scene, callback?: () => void) {\r\n\t\tthis.scene = scene;\r\n\t\tthis.callback = callback;\r\n\t\tthis.clearHouses();\r\n\t}\r\n\r\n\tpublic getOriginalHouse(callback: newHouseCallback): void {\r\n\t\tif (this.originalHouse !== null) {\r\n\t\t\t// Already loaded\r\n\t\t\tthis.executeCallbacks(callback, this.originalHouse);\r\n\t\t} else {\r\n\t\t\t// Not yet loaded\r\n\t\t\tBABYLON.SceneLoader.Append(\"./\", \"house.babylon\", this.scene, () => {\r\n\t\t\t\tlet house = <BABYLON.Mesh>this.scene.getNodeByID(\"house\");\r\n\r\n\t\t\t\t// Very first one, we hide it because it is meant as more a template\r\n\t\t\t\thouse.setEnabled(false);\r\n\t\t\t\tthis.originalHouse = house;\r\n\r\n\t\t\t\tthis.executeCallbacks(callback, house);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tpublic addHouseClone(callback?: newHouseCallback): void {\r\n\t\tthis.getOriginalHouse((originalHouse) => {\r\n\t\t\tconst house = <BABYLON.Mesh>(originalHouse as BABYLON.Mesh).clone(\"house_\" + this.houses.length);\r\n\t\t\tthis.addAndPosition(house);\r\n\t\t\tthis.executeCallbacks(callback, house);\r\n\t\t});\r\n\t}\r\n\r\n\tpublic addHouseCreateInstance(callback?: newHouseCallback): void {\r\n\t\tthis.getOriginalHouse((originalHouse) => {\r\n\t\t\tconst house = <BABYLON.InstancedMesh>(originalHouse as BABYLON.Mesh).createInstance(\"house_\" + this.houses.length);\r\n\t\t\tthis.addAndPosition(house);\r\n\t\t\tthis.executeCallbacks(callback, house);\r\n\t\t});\r\n\t}\r\n\r\n\tprivate addAndPosition(house: BABYLON.AbstractMesh) {\r\n\t\tthis.houses.push(house);\r\n\r\n\t\thouse.position.y = 0;\r\n\t\thouse.position.x = this.nextX;\r\n\t\thouse.position.z = this.nextZ;\r\n\r\n\t\tthis.nextX += this.incrementX;\r\n\t\tif (this.nextX >= this.xEnd) {\r\n\t\t\tthis.nextX = this.xStart;\r\n\t\t\tthis.nextZ += this.incrementZ;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic executeCallbacks(callback?: newHouseCallback, house?: BABYLON.AbstractMesh): void {\r\n\t\twindow.setTimeout(() => {\r\n\t\t\tif (callback !== undefined) {\r\n\t\t\t\tcallback(house);\r\n\t\t\t}\r\n\t\t\tif (this.callback !== undefined) {\r\n\t\t\t\tthis.callback();\r\n\t\t\t}\r\n\t\t}, 0);\r\n\t}\r\n\r\n\tpublic clearHouses() {\r\n\t\tif (this.houses.length > 0) {\r\n\t\t\t// Remove the houses\r\n\t\t\tthis.houses.forEach(value => {\r\n\t\t\t\tvalue.dispose();\r\n\t\t\t});\r\n\t\t\tthis.houses = [];\r\n\t\t}\r\n\r\n\t\t// Restart positioning\r\n\t\tthis.nextX = this.xStart;\r\n\t\tthis.nextZ = 0;\r\n\r\n\t\t// Inform callback that a change took place\r\n\t\tthis.executeCallbacks();\r\n\t}\r\n\r\n\tpublic mergeHouses() {\r\n\t\tlet mergedHouses = BABYLON.Mesh.MergeMeshes(<BABYLON.Mesh[]>this.houses, true, true)\r\n\r\n\t\tconst red = new BABYLON.StandardMaterial(\"red\", this.scene);\r\n\t\tred.diffuseColor = new BABYLON.Color3(1, 0, 0);\r\n\t\tmergedHouses.material = red;\r\n\t}\r\n\r\n\tpublic lodManual() {\r\n\t\tthis.lodRemoveAll();\r\n\t\tthis.getOriginalHouse((arg) => {\r\n\t\t\tconst original = arg as BABYLON.Mesh;\r\n\t\t\tthis._lodRemoveAll(original);\r\n\r\n\t\t\t// Create box\r\n\t\t\tconst box = BABYLON.MeshBuilder.CreateBox(original.id + \"_box\", {width: 0.5, height: 0.7, depth: 0.5}, this.scene);\r\n\t\t\tconst boxMaterial = new BABYLON.StandardMaterial(original.id + \"_material\", this.scene);\r\n\t\t\tboxMaterial.diffuseColor = new BABYLON.Color3(0, 0, 0);\r\n\t\t\tbox.material = boxMaterial;\r\n\t\t\tbox.setEnabled(false);\r\n\r\n\t\t\toriginal.addLODLevel(15, box);\r\n\t\t});\r\n\t}\r\n\r\n\tpublic lodAutomatic() {\r\n\t\tthis.getOriginalHouse((arg) => {\r\n\t\t\tconst original = arg as BABYLON.Mesh;\r\n\t\t\tthis._lodRemoveAll(original);\r\n\r\n\t\t\toriginal.simplify([\r\n\t\t\t\t\t{quality: 0.6, distance: 10, optimizeMesh: true},\r\n\t\t\t\t\t{quality: 0.2, distance: 15, optimizeMesh: true},\r\n\t\t\t\t], true, BABYLON.SimplificationType.QUADRATIC, function() {\r\n\t\t\t\talert('Done.');\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tpublic lodRemoveAll() {\r\n\t\tthis.getOriginalHouse((arg) => {\r\n\t\t\tthis._lodRemoveAll(arg as BABYLON.Mesh);\r\n\t\t});\r\n\t}\r\n\tprivate _lodRemoveAll(original: BABYLON.Mesh) {\r\n\t\toriginal.getLODLevels().forEach((lodLevel) => {\r\n\t\t\toriginal.removeLODLevel(lodLevel.mesh);\r\n\t\t})\r\n\t}\r\n\r\n}\r\n","import * as BABYLON from 'babylonjs';\r\n\r\nexport default class SmartRenderer {\r\n\tpublic alwaysRender: boolean = false;\r\n\tpublic forceRenderOnce: boolean = true;\r\n\r\n\tprivate scene: BABYLON.Scene;\r\n\tprivate lastPosition: BABYLON.Vector3 = null;\r\n\tprivate lastRotation: BABYLON.Vector3 = null;\r\n\r\n\tconstructor(scene: BABYLON.Scene) {\r\n\t\tthis.scene = scene;\r\n\t\tscene.getEngine().runRenderLoop(this.onRender);\r\n\t\twindow.addEventListener('resize', this.onWinResize);\r\n\t}\r\n\r\n\tprivate readonly onWinResize = (): void => {\r\n\t\tthis.scene.getEngine().resize();\r\n\t\tthis.forceRenderOnce = true;\r\n\t}\r\n\r\n\tprivate readonly onRender = (): void => {\r\n\t\tif (this.isRenderNeeded()) {\r\n\t\t\tconst activeCamera = <BABYLON.TargetCamera>this.scene.activeCamera;\r\n\t\t\tthis.lastPosition = activeCamera.position.clone();\r\n\t\t\tthis.lastRotation = activeCamera.rotation.clone();\r\n\r\n\t\t\tthis.forceRenderOnce = false;\r\n\r\n\t\t\tthis.scene.render();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate isRenderNeeded(): boolean {\r\n\t\tif (this.alwaysRender == true || this.forceRenderOnce === true || this.scene.animatables.length > 0) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\t// Has camera moved?\r\n\t\tconst activeCamera = <BABYLON.TargetCamera>this.scene.activeCamera;\r\n\t\tactiveCamera.update(); // Must call update so position and lastRotation are correct\r\n\t\tif (!this.lastPosition.equals(activeCamera.position) || !this.lastRotation.equals(activeCamera.rotation)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tif (this.scene.debugLayer.isVisible()) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n}\r\n","import CookieCutterSuburbia from './CookieCutterSuburbia';\r\nimport SmartRender from './SmartRender';\r\nimport HouseBuilder from './HouseBuilder';\r\n\r\nconst canvas = <HTMLCanvasElement>document.getElementById('renderCanvas');\r\nconst suburbia = new CookieCutterSuburbia(canvas);\r\nconst scene = suburbia.scene;\r\n\r\n/*\r\n * TODO:\r\n * - Make way to stop / start box from spinning\r\n * - Optimize more\r\n * \t\t- Try freezing and others\r\n * \t\t- Try LOD - https://doc.babylonjs.com/how_to/in-browser_mesh_simplification\r\n * - Add count of number of houses\r\n *\r\n *\tNOTE\r\n * - On scene setting adaptToDeviceRatio to false had drastic affect... like 33fps to 55fps\r\n *\r\n */\r\n\r\n/* ===================================================================================================\r\n * Smart Renderer\r\n */\r\nconst smartRender = new SmartRender(scene);\r\nconst smartRenderToggle = document.getElementById(\"smartRenderToggle\");\r\nfunction updateSmartRenderToggleStyleClass() {\r\n\tsmartRenderToggle.classList.toggle(\"toggleOff\", !smartRender.alwaysRender);\r\n}\r\nsmartRenderToggle.addEventListener(\"click\", (event: Event) => {\r\n\tsmartRender.alwaysRender = !smartRender.alwaysRender;\r\n\tupdateSmartRenderToggleStyleClass();\r\n});\r\nupdateSmartRenderToggleStyleClass();\r\n\r\n/* ===================================================================================================\r\n * Houses\r\n */\r\nconst houseBuilder = new HouseBuilder(scene, () => {\r\n\t// Rerender when house loaded\r\n\tsmartRender.forceRenderOnce = true;\r\n});\r\nconst housesNumberToAdd = <HTMLInputElement>document.getElementById(\"housesNumberToAdd\");\r\ndocument.getElementById(\"cloneHouse\").addEventListener(\"click\", (event: Event) => {\r\n\tevent.preventDefault();\r\n\tlet numberToAdd = parseInt(housesNumberToAdd.value);\r\n\tfunction addAnother() {\r\n\t\tif (numberToAdd-- > 0)\r\n\t\t\thouseBuilder.addHouseClone(addAnother);\r\n\t}\r\n\taddAnother();\r\n});\r\ndocument.getElementById(\"createInstanceHouse\").addEventListener(\"click\", (event: Event) => {\r\n\tevent.preventDefault();\r\n\tlet numberToAdd = parseInt(housesNumberToAdd.value);\r\n\tfunction addAnother() {\r\n\t\tif (numberToAdd-- > 0)\r\n\t\t\thouseBuilder.addHouseCreateInstance(addAnother);\r\n\t}\r\n\taddAnother();\r\n});\r\ndocument.getElementById(\"clearHouses\").addEventListener(\"click\", (event: Event) => {\r\n\tevent.preventDefault();\r\n\thouseBuilder.clearHouses();\r\n});\r\ndocument.getElementById(\"mergeHouses\").addEventListener(\"click\", (event: Event) => {\r\n\tevent.preventDefault();\r\n\thouseBuilder.mergeHouses();\r\n});\r\n\r\ndocument.getElementById(\"lodManual\").addEventListener(\"click\", (event: Event) => {\r\n\tevent.preventDefault();\r\n\thouseBuilder.lodManual();\r\n});\r\ndocument.getElementById(\"lodAutomatic\").addEventListener(\"click\", (event: Event) => {\r\n\tevent.preventDefault();\r\n\thouseBuilder.lodAutomatic();\r\n});\r\ndocument.getElementById(\"lodRemoveAll\").addEventListener(\"click\", (event: Event) => {\r\n\tevent.preventDefault();\r\n\thouseBuilder.lodRemoveAll();\r\n});\r\n/* ===================================================================================================\r\n * Debugger\r\n */\r\ndocument.getElementById(\"debugLayerToggle\").addEventListener(\"click\", (event: Event) => {\r\n\tevent.preventDefault();\r\n\r\n\tif (scene.debugLayer.isVisible()) {\r\n\t\tscene.debugLayer.hide();\r\n\t} else {\r\n\t\tscene.debugLayer.show();\r\n\t}\r\n});\r\n"]}