{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/CookieCutterSuburbia.ts","src/HouseBuilder.ts","src/SmartRender.ts","src/main.ts"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","BABYLON","Texture","CookieCutterSuburbia","canvas","this","frameRate","boxAnimatable","engine","Engine","scene","Scene","clearColor","Color4","ambientColor","Color3","camera","UniversalCamera","Vector3","rotation","speed","attachControl","HemisphericLight","intensity","PointLight","box","MeshBuilder","CreateBox","width","height","depth","position","y","Math","PI","ground","CreateGround","subdivisions","red","StandardMaterial","diffuseColor","material","groundTexture","uScale","vScale","wrapU","MIRROR_ADDRESSMODE","wrapV","groundMaterial","diffuseTexture","intervalID","setInterval","isReady","render","clearInterval","yRot","Animation","ANIMATIONTYPE_FLOAT","ANIMATIONLOOPMODE_CYCLE","keyFramesR","push","frame","value","setKeys","prototype","toggleAnimation","beginDirectAnimation","stop","HouseBuilder","callback","incrementX","incrementZ","xStart","xEnd","originalHouse","houses","clearHouses","getOriginalHouse","_this","executeCallbacks","SceneLoader","Append","house","getNodeByID","setEnabled","addHouseClone","clone","addAndPosition","addHouseCreateInstance","createInstance","x","nextX","z","nextZ","window","setTimeout","undefined","forEach","dispose","mergeHouses","mergedHouses","Mesh","MergeMeshes","lodManual","lodRemoveAll","arg","original","_lodRemoveAll","id","boxMaterial","addLODLevel","lodAutomatic","simplify","quality","distance","optimizeMesh","SimplificationType","QUADRATIC","alert","getLODLevels","lodLevel","removeLODLevel","mesh","SmartRenderer","alwaysRender","forceRenderOnce","lastPosition","lastRotation","onWinResize","getEngine","resize","onRender","isRenderNeeded","activeCamera","runRenderLoop","addEventListener","animatables","update","equals","debugLayer","isVisible","CookieCutterSuburbia_1","SmartRender_1","HouseBuilder_1","document","getElementById","suburbia","default","smartRender","smartRenderToggle","updateSmartRenderToggleStyleClass","classList","toggle","event","houseBuilder","housesNumberToAdd","preventDefault","numberToAdd","parseInt","addAnother","hide","show"],"mappings":"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","file":"main.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","import * as BABYLON from 'babylonjs';\r\nimport Texture = BABYLON.Texture;\r\n\r\nexport default class CookieCutterSuburbia {\r\n\tpublic scene: BABYLON.Scene;\r\n\r\n\tprivate readonly frameRate = 200;\r\n\tprivate box: BABYLON.Mesh;\r\n\tprivate yRot: BABYLON.Animation;\r\n\tprivate boxAnimatable: BABYLON.Animatable = null;\r\n\r\n\tconstructor(canvas: HTMLCanvasElement) {\r\n\t\tconst adaptToDeviceRatio = false;\r\n\t\tconst engine = new BABYLON.Engine(canvas, true, {}, adaptToDeviceRatio);\r\n\r\n\t\tconst scene = new BABYLON.Scene(engine);\r\n\t\tscene.clearColor = new BABYLON.Color4(0.5, 0.8, 0.8, 1);\r\n\t\tscene.ambientColor = new BABYLON.Color3(0.3, 0.3, 0.3);\r\n\r\n\t\tconst camera = new BABYLON.UniversalCamera(\"camera\", new BABYLON.Vector3(-5, 1.5, 4), scene);\r\n\t\tcamera.rotation = new BABYLON.Vector3(0.14, 8.5, 0);\r\n\t\tcamera.speed = 0.4;\r\n\t\tcamera.attachControl(canvas, true);\r\n\r\n\t\tconst hemiLight = new BABYLON.HemisphericLight('hemiLight', new BABYLON.Vector3(-0.5, -1, -0.5), scene);\r\n\t\themiLight.intensity = 0.2;\r\n\r\n\t\tconst pointLight = new BABYLON.PointLight('pointLight', new BABYLON.Vector3(-3, 5, 3), scene);\r\n\t\tpointLight.intensity = 0.50;\r\n\r\n\t\tconst pointLight_2 = new BABYLON.PointLight('pointLight_2', new BABYLON.Vector3(8, 35, 22), scene);\r\n\t\tpointLight_2.intensity = 0.50;\r\n\r\n\t\t// Create box\r\n\t\tconst box = BABYLON.MeshBuilder.CreateBox(\"box\", {width: 1, height: 1, depth: 1}, scene);\r\n\t\tbox.position.y = 1.5;\r\n\t\tbox.rotation = new BABYLON.Vector3(Math.PI/4, Math.PI/4, Math.PI/4);\r\n\r\n\t\t// Create ground\r\n\t\tconst ground = BABYLON.MeshBuilder.CreateGround(\"ground\", {width: 80, height: 80, subdivisions: 8}, scene);\r\n\r\n\t\t// Material for box\r\n\t\tconst red = new BABYLON.StandardMaterial(\"red\", scene);\r\n\t\tred.diffuseColor = new BABYLON.Color3(1, 0, 0);\r\n\t\tbox.material = red;\r\n\r\n\t\t// Material for ground\r\n\t\tconst groundTexture = new BABYLON.Texture(\"./grass.jpg\", scene);\r\n\t\tgroundTexture.uScale = 8;\r\n\t\tgroundTexture.vScale = 8;\r\n\t\tgroundTexture.wrapU = Texture.MIRROR_ADDRESSMODE;\r\n\t\tgroundTexture.wrapV = Texture.MIRROR_ADDRESSMODE;\r\n\t\tconst groundMaterial = new BABYLON.StandardMaterial(\"grass\", scene);\r\n\t\tgroundMaterial.diffuseTexture = groundTexture;\r\n\t\tconst installMaterialWhenTextureReady = () => {\r\n\t\t\tif (groundTexture.isReady()) {\r\n\t\t\t\tground.material = groundMaterial;\r\n\t\t\t\tscene.render();\r\n\t\t\t\tclearInterval(intervalID);\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet intervalID = setInterval(installMaterialWhenTextureReady, 100);\r\n\r\n\t\t// Rotate box the box\r\n\t\tlet yRot = new BABYLON.Animation(\"yRot\", \"rotation.y\", this.frameRate, BABYLON.Animation.ANIMATIONTYPE_FLOAT, BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE);\r\n\t\tvar keyFramesR = [];\r\n\t\tkeyFramesR.push({\r\n\t\t\tframe: 0,\r\n\t\t\tvalue: 0\r\n\t\t});\r\n\t\tkeyFramesR.push({\r\n\t\t\tframe: 2 * this.frameRate,\r\n\t\t\tvalue: 2 * Math.PI\r\n\t\t});\r\n\t\tyRot.setKeys(keyFramesR);\r\n\r\n\t\tthis.yRot = yRot;\r\n\t\tthis.box = box;\r\n\t\tthis.scene = scene;\r\n\t}\r\n\r\n\tpublic toggleAnimation() {\r\n\t\tif (this.boxAnimatable === null) {\r\n\t\t\tthis.boxAnimatable = this.scene.beginDirectAnimation(this.box, [this.yRot], 0, 2 * this.frameRate, true);\r\n\t\t} else {\r\n\t\t\tthis.boxAnimatable.stop();\r\n\t\t\tthis.boxAnimatable = null;\r\n\t\t}\r\n\t}\r\n}\r\n","import * as BABYLON from 'babylonjs';\r\n\r\ninterface newHouseCallback {\r\n\t(house: BABYLON.AbstractMesh): void;\r\n}\r\n\r\nexport default class HouseBuilder {\r\n\tprivate readonly scene: BABYLON.Scene;\r\n\tprivate readonly callback: (() => void) | undefined;\r\n\r\n\tprivate readonly incrementX = 1;\r\n\tprivate readonly incrementZ = -1;\r\n\tprivate readonly xStart = 0;\r\n\tprivate readonly xEnd = 20;\r\n\tprivate nextX: number;\r\n\tprivate nextZ: number;\r\n\r\n\tprivate originalHouse: BABYLON.Mesh = null;\r\n\tprivate houses: BABYLON.AbstractMesh[] = [];\r\n\r\n\tconstructor(scene: BABYLON.Scene, callback?: () => void) {\r\n\t\tthis.scene = scene;\r\n\t\tthis.callback = callback;\r\n\t\tthis.clearHouses();\r\n\t}\r\n\r\n\tpublic getOriginalHouse(callback: newHouseCallback): void {\r\n\t\tif (this.originalHouse !== null) {\r\n\t\t\t// Already loaded\r\n\t\t\tthis.executeCallbacks(callback, this.originalHouse);\r\n\t\t} else {\r\n\t\t\t// Not yet loaded\r\n\t\t\tBABYLON.SceneLoader.Append(\"./\", \"house.babylon\", this.scene, () => {\r\n\t\t\t\tlet house = <BABYLON.Mesh>this.scene.getNodeByID(\"house\");\r\n\r\n\t\t\t\t// Very first one, we hide it because it is meant as more a template\r\n\t\t\t\thouse.setEnabled(false);\r\n\t\t\t\tthis.originalHouse = house;\r\n\r\n\t\t\t\tthis.executeCallbacks(callback, house);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tpublic addHouseClone(callback?: newHouseCallback): void {\r\n\t\tthis.getOriginalHouse((originalHouse) => {\r\n\t\t\tconst house = <BABYLON.Mesh>(originalHouse as BABYLON.Mesh).clone(\"house_\" + this.houses.length);\r\n\t\t\tthis.addAndPosition(house);\r\n\t\t\tthis.executeCallbacks(callback, house);\r\n\t\t});\r\n\t}\r\n\r\n\tpublic addHouseCreateInstance(callback?: newHouseCallback): void {\r\n\t\tthis.getOriginalHouse((originalHouse) => {\r\n\t\t\tconst house = <BABYLON.InstancedMesh>(originalHouse as BABYLON.Mesh).createInstance(\"house_\" + this.houses.length);\r\n\t\t\tthis.addAndPosition(house);\r\n\t\t\tthis.executeCallbacks(callback, house);\r\n\t\t});\r\n\t}\r\n\r\n\tprivate addAndPosition(house: BABYLON.AbstractMesh) {\r\n\t\tthis.houses.push(house);\r\n\r\n\t\thouse.position.y = 0;\r\n\t\thouse.position.x = this.nextX;\r\n\t\thouse.position.z = this.nextZ;\r\n\r\n\t\tthis.nextX += this.incrementX;\r\n\t\tif (this.nextX >= this.xEnd) {\r\n\t\t\tthis.nextX = this.xStart;\r\n\t\t\tthis.nextZ += this.incrementZ;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic executeCallbacks(callback?: newHouseCallback, house?: BABYLON.AbstractMesh): void {\r\n\t\twindow.setTimeout(() => {\r\n\t\t\tif (callback !== undefined) {\r\n\t\t\t\tcallback(house);\r\n\t\t\t}\r\n\t\t\tif (this.callback !== undefined) {\r\n\t\t\t\tthis.callback();\r\n\t\t\t}\r\n\t\t}, 0);\r\n\t}\r\n\r\n\tpublic clearHouses() {\r\n\t\tif (this.houses.length > 0) {\r\n\t\t\t// Remove the houses\r\n\t\t\tthis.houses.forEach(value => {\r\n\t\t\t\tvalue.dispose();\r\n\t\t\t});\r\n\t\t\tthis.houses = [];\r\n\t\t}\r\n\r\n\t\t// Restart positioning\r\n\t\tthis.nextX = this.xStart;\r\n\t\tthis.nextZ = 0;\r\n\r\n\t\t// Inform callback that a change took place\r\n\t\tthis.executeCallbacks();\r\n\t}\r\n\r\n\tpublic mergeHouses() {\r\n\t\tlet mergedHouses = BABYLON.Mesh.MergeMeshes(<BABYLON.Mesh[]>this.houses, true, true)\r\n\r\n\t\tconst red = new BABYLON.StandardMaterial(\"red\", this.scene);\r\n\t\tred.diffuseColor = new BABYLON.Color3(1, 0, 0);\r\n\t\tmergedHouses.material = red;\r\n\t}\r\n\r\n\tpublic lodManual() {\r\n\t\tthis.lodRemoveAll();\r\n\t\tthis.getOriginalHouse((arg) => {\r\n\t\t\tconst original = arg as BABYLON.Mesh;\r\n\t\t\tthis._lodRemoveAll(original);\r\n\r\n\t\t\t// Create box\r\n\t\t\tconst box = BABYLON.MeshBuilder.CreateBox(original.id + \"_box\", {width: 0.5, height: 0.7, depth: 0.5}, this.scene);\r\n\t\t\tconst boxMaterial = new BABYLON.StandardMaterial(original.id + \"_material\", this.scene);\r\n\t\t\tboxMaterial.diffuseColor = new BABYLON.Color3(0, 0, 0);\r\n\t\t\tbox.material = boxMaterial;\r\n\t\t\tbox.setEnabled(false);\r\n\r\n\t\t\toriginal.addLODLevel(15, box);\r\n\t\t});\r\n\t}\r\n\r\n\tpublic lodAutomatic() {\r\n\t\tthis.getOriginalHouse((arg) => {\r\n\t\t\tconst original = arg as BABYLON.Mesh;\r\n\t\t\tthis._lodRemoveAll(original);\r\n\r\n\t\t\toriginal.simplify([\r\n\t\t\t\t\t{quality: 0.6, distance: 10, optimizeMesh: true},\r\n\t\t\t\t\t{quality: 0.2, distance: 15, optimizeMesh: true},\r\n\t\t\t\t], true, BABYLON.SimplificationType.QUADRATIC, function() {\r\n\t\t\t\talert('Done.');\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tpublic lodRemoveAll() {\r\n\t\tthis.getOriginalHouse((arg) => {\r\n\t\t\tthis._lodRemoveAll(arg as BABYLON.Mesh);\r\n\t\t});\r\n\t}\r\n\tprivate _lodRemoveAll(original: BABYLON.Mesh) {\r\n\t\toriginal.getLODLevels().forEach((lodLevel) => {\r\n\t\t\toriginal.removeLODLevel(lodLevel.mesh);\r\n\t\t})\r\n\t}\r\n\r\n}\r\n","import * as BABYLON from 'babylonjs';\r\n\r\nexport default class SmartRenderer {\r\n\tpublic alwaysRender: boolean = false;\r\n\tpublic forceRenderOnce: boolean = true;\r\n\r\n\tprivate scene: BABYLON.Scene;\r\n\tprivate lastPosition: BABYLON.Vector3 = null;\r\n\tprivate lastRotation: BABYLON.Vector3 = null;\r\n\r\n\tconstructor(scene: BABYLON.Scene) {\r\n\t\tthis.scene = scene;\r\n\t\tscene.getEngine().runRenderLoop(this.onRender);\r\n\t\twindow.addEventListener('resize', this.onWinResize);\r\n\t}\r\n\r\n\tprivate readonly onWinResize = (): void => {\r\n\t\tthis.scene.getEngine().resize();\r\n\t\tthis.forceRenderOnce = true;\r\n\t}\r\n\r\n\tprivate readonly onRender = (): void => {\r\n\t\tif (this.isRenderNeeded()) {\r\n\t\t\tconst activeCamera = <BABYLON.TargetCamera>this.scene.activeCamera;\r\n\t\t\tthis.lastPosition = activeCamera.position.clone();\r\n\t\t\tthis.lastRotation = activeCamera.rotation.clone();\r\n\r\n\t\t\tthis.forceRenderOnce = false;\r\n\r\n\t\t\tthis.scene.render();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate isRenderNeeded(): boolean {\r\n\t\tif (this.alwaysRender == true || this.forceRenderOnce === true || this.scene.animatables.length > 0) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\t// Has the camera moved?\r\n\t\tconst activeCamera = <BABYLON.TargetCamera>this.scene.activeCamera;\r\n\t\tactiveCamera.update(); // Must call update so position and lastRotation are correct\r\n\t\tif (!this.lastPosition.equals(activeCamera.position) || !this.lastRotation.equals(activeCamera.rotation)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\t// Always render if debug layer is open since the user may be modifying properties\r\n\t\tif (this.scene.debugLayer.isVisible()) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n}\r\n","import CookieCutterSuburbia from './CookieCutterSuburbia';\r\nimport SmartRender from './SmartRender';\r\nimport HouseBuilder from './HouseBuilder';\r\n\r\nconst canvas = <HTMLCanvasElement>document.getElementById('renderCanvas');\r\nconst suburbia = new CookieCutterSuburbia(canvas);\r\nconst scene = suburbia.scene;\r\n\r\n/* ===================================================================================================\r\n * Smart Renderer\r\n */\r\nconst smartRender = new SmartRender(scene);\r\nconst smartRenderToggle = document.getElementById(\"smartRenderToggle\");\r\nfunction updateSmartRenderToggleStyleClass() {\r\n\tsmartRenderToggle.classList.toggle(\"toggleOff\", !smartRender.alwaysRender);\r\n}\r\nsmartRenderToggle.addEventListener(\"click\", (event: Event) => {\r\n\tsmartRender.alwaysRender = !smartRender.alwaysRender;\r\n\tupdateSmartRenderToggleStyleClass();\r\n});\r\nupdateSmartRenderToggleStyleClass();\r\n\r\n/* ===================================================================================================\r\n * Houses\r\n */\r\nconst houseBuilder = new HouseBuilder(scene, () => {\r\n\t// Rerender when house loaded\r\n\tsmartRender.forceRenderOnce = true;\r\n});\r\nconst housesNumberToAdd = <HTMLInputElement>document.getElementById(\"housesNumberToAdd\");\r\ndocument.getElementById(\"cloneHouse\").addEventListener(\"click\", (event: Event) => {\r\n\tevent.preventDefault();\r\n\tlet numberToAdd = parseInt(housesNumberToAdd.value);\r\n\tfunction addAnother() {\r\n\t\tif (numberToAdd-- > 0)\r\n\t\t\thouseBuilder.addHouseClone(addAnother);\r\n\t}\r\n\taddAnother();\r\n});\r\ndocument.getElementById(\"createInstanceHouse\").addEventListener(\"click\", (event: Event) => {\r\n\tevent.preventDefault();\r\n\tlet numberToAdd = parseInt(housesNumberToAdd.value);\r\n\tfunction addAnother() {\r\n\t\tif (numberToAdd-- > 0)\r\n\t\t\thouseBuilder.addHouseCreateInstance(addAnother);\r\n\t}\r\n\taddAnother();\r\n});\r\ndocument.getElementById(\"clearHouses\").addEventListener(\"click\", (event: Event) => {\r\n\tevent.preventDefault();\r\n\thouseBuilder.clearHouses();\r\n});\r\ndocument.getElementById(\"mergeHouses\").addEventListener(\"click\", (event: Event) => {\r\n\tevent.preventDefault();\r\n\thouseBuilder.mergeHouses();\r\n});\r\n\r\n/* ===================================================================================================\r\n * Box animation\r\n */\r\ndocument.getElementById(\"animationToggle\").addEventListener(\"click\", (event: Event) => {\r\n\tevent.preventDefault();\r\n\tsuburbia.toggleAnimation();\r\n});\r\n\r\n/* ===================================================================================================\r\n * LOD\r\n */\r\ndocument.getElementById(\"lodManual\").addEventListener(\"click\", (event: Event) => {\r\n\tevent.preventDefault();\r\n\thouseBuilder.lodManual();\r\n});\r\ndocument.getElementById(\"lodAutomatic\").addEventListener(\"click\", (event: Event) => {\r\n\tevent.preventDefault();\r\n\thouseBuilder.lodAutomatic();\r\n});\r\ndocument.getElementById(\"lodRemoveAll\").addEventListener(\"click\", (event: Event) => {\r\n\tevent.preventDefault();\r\n\thouseBuilder.lodRemoveAll();\r\n});\r\n/* ===================================================================================================\r\n * Debugger\r\n */\r\ndocument.getElementById(\"debugLayerToggle\").addEventListener(\"click\", (event: Event) => {\r\n\tevent.preventDefault();\r\n\r\n\tif (scene.debugLayer.isVisible()) {\r\n\t\tscene.debugLayer.hide();\r\n\t} else {\r\n\t\tscene.debugLayer.show();\r\n\t}\r\n});\r\n"]}